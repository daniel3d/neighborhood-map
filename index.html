<!DOCTYPE html>
<html>

<head>
	<title>Restaurants</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta charset="utf-8">
	<!-- Styles -->
	<link href="https://fonts.googleapis.com/css?family=Damion" rel="stylesheet">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
	<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
	<link rel="stylesheet" href="assets/styles.css">
</head>

<body>

	<!-- Google map -->
	<main id="map-canvas"></main>

	<!-- UI panel -->
	<aside class="panel" id="panel-left" data-bind="css:{'hide': !panelVisible()}">

		<!-- Logo and mobile nav-bar -->
		<nav class="title">
			<i class="material-icons">restaurant</i> Restaurants
			<span class="credits">Powered By Zomato</span> 
			<button class="nav-icon" data-bind='click: tooglePanel, css: {x : panelVisible() }'>
				<span class="navLines"></span>
			</button>
		</nav>

		<!-- Search bar -->
		<section class="panel-search">
			<input id="location-search" type="text" placeholder="Enter a location">
		</section>

		<!-- Loading bar -->
		<section data-bind="visible: status().loading" class="mdl-progress mdl-js-progress mdl-progress__indeterminate mdl-progress-pink"></section>

		<!-- Status panel only visible when we have status message -->
		<section class="panel-status" data-bind="visible: status().text != ''">
			<i class="material-icons md-48" data-bind="text: status().icon"></i>
			<p data-bind="text: status().text"></p>
		</section>

		<!-- List of resturants -->
		<section class="panel-items" data-bind="foreach: restaurants">
			<article class="panel-item" data-bind="click: $parent.openMarkerInfo, attr: { id: 'restaurant_' + restaurant.id }, css: {active: $parent.curentRestaurant() && $parent.curentRestaurant().id == restaurant.id }">
				<div class="panel-item-image" data-bind="style: {'backgroundImage': 'url('+ restaurant.thumb +')'}"></div>
				<div class="panel-item-content">
					<header>
						<h4 class="item-title" data-bind="text: restaurant.name"></h4>
					</header>
					<p class="item-desciption" data-bind="text: restaurant.cuisines"></p>
					<div class="item-rating">
						<span class="ratings" data-bind="css: restaurant.user_rating.rating_class"></span>
						<small>
							<span data-bind="text: restaurant.user_rating.aggregate_rating"></span> /
							<span data-bind="text: restaurant.user_rating.votes"></span>
						</small>
					</div>
					<div class="item-location">
						<small>
							<span data-bind="text: restaurant.location.address"></span>
						</small>
					</div>
				</div>
			</article>
		</section>

	</aside>

	<!-- Scripts -->
	<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	<script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script defer src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-debug.js"></script>
	<script defer src="assets/app.js"></script>
	<script>
		// Load Google maps asycnronesly when ready start the ko app
		window.onload = function() {
			$.getScript("https://maps.googleapis.com/maps/api/js?"+
				atob('a2V5PUFJemFTeUNVdGpzejVFVktTSEJ3OHJKTUZCZUFTQXlaUUtPa0dBNA==')+"&libraries=places,geometry")
			.done(function(script, textStatus){
				if(textStatus == 'success'){
					ko.applyBindings(new NeighborhoodMapViewModel());
					return;
				} ErrorLoading();
			})
			.fail(function(jqxhr, settings, exception){
				ErrorLoading();
			});
		}
		// Handle error while loading.
		function ErrorLoading(message){
			var canvas = document.getElementById("map-canvas");
			message = message || 'Oops! We had problem loading, please reload the page.';
			canvas.className = 'error';
			canvas.innerHTML = '<i class="material-icons">warning</i> \
			<p>'+message+'</p>';
		}
	</script>

</body>

</html>